<div class="input">
  <!-- top left: where label goes -->
  <label style="grid-column: 1 / 2;" for="location">
    Select location
  </label>
  <!-- top right: where errors belong -->
  <p style="grid-column: 2 / 3;">
    <% if (formErrors && 'location' in formErrors) { %>
      <small class="error">
        <b>Error: </b>
        <%= formErrors['location'] %>
      </small>
    <% } %>
  </p>
  <!-- bottom: where input goes -->
  <select style="grid-column: 1 / 3;" name="location" id="location">
    <% directoryTree.forEach(location => { %>
      <option value=<%=location.id || 'home' %>>
        <%= location.name %>
      </option>
    <% }) %>
  </select>
</div>

<script defer>
  const locationDropdown = document.getElementById('location')
  // FIRST, does prevForm have a directory id?
  let value = '<%= locals.prevForm?.location %>'
  if (value) {
    locationDropdown.value = value
    console.log('prefilled using prevForm')
  } else {
    // SECOND, does currentFile exist and does it have a directory id?
    if (<%= "currentFile" in locals %>) {
      value = '<%= locals.currentFile?.directoryId %>'
      locationDropdown.value = value === '' ? 'home' : value
      console.log('prefilled using currentFile')
    } else {
      // THIRD, does our url param have a directory id?
      const urlParams = new URLSearchParams(window.location.search);
      const dest = urlParams.get('dest');
      locationDropdown.value = dest ?? 'home'
      console.log('prefilled using query')
    }
  }
</script>